var EMAIL_DRAFTED = "EMAIL DRAFTED";

function draftMyEmails() {
  var sheet = SpreadsheetApp.getActiveSheet(); 
  var startRow = 2;                            
  var numRows = sheet.getLastRow() - 1;        
  var lastColumn = sheet.getLastColumn();      
  var dataRange = sheet.getRange(startRow, 1, numRows, lastColumn) 
  var data = dataRange.getValues();            
  
  for (var i = 0; i < data.length; ++i) {
    var row = data[i];                 
    var partnerEmail = row[0];               
    var partner = row[1];                       
    var PickupFulfillmentDate = row[20];  
    var PickupWindow = row[21];    
    var PickupFulfillmentDate2 = row[22];  
    var PickupWindow2 = row[23];               
    var DeliveryFulfillmentDate = row[24];  
    var DeliveryWindow = row[25];                
    var thismonth = row[18];      
    var FulfillmentReportLink = row[27]; 
    var PMname = row[28];             
    var emailStatus = row[lastColumn - 1];  
    
    if (emailStatus !== EMAIL_DRAFTED && partnerEmail) {  
    
      
      var emailBody =  '<p>Hi ' + partner + ' team,<p>';
        emailBody += '<p><font size="+5"> </font><p>';
        emailBody += '<p>Table22 here — reaching out to remind you that your <strong>final order counts</strong> for this month’s fulfillment are now available in the <strong><a href="https://app.table22.com/partner">Table 22 Partner Portal</a></strong>, which will help your team prepare for your upcoming fulfillment on:<p>';
        emailBody += '<p><font size="-1"> </font><p>';  
        emailBody += '<p><strong>Pickup:<br><FONT COLOR="#008000">' + PickupFulfillmentDate + ' ' + PickupWindow + '</FONT></strong><p>'; 
        emailBody += '<p><strong><FONT COLOR="#008000">' + PickupFulfillmentDate2 + ' ' + PickupWindow2 + '</FONT></strong><p>'; 
        emailBody += '<p><strong>Delivery:<br><FONT COLOR="#008000">' + DeliveryFulfillmentDate + ' ' + DeliveryWindow + '</FONT></strong><p>';
        emailBody += '<p><font size="-1"> </font><p>';
        emailBody += '<p>You can review a summary of your orders in the “Fulfillment Report” tab and a more detailed list in the “Cohort Rosters” tab.<p>';
        emailBody += '<p>Don’t hesitate to reach out if you have any questions!<p>';
        emailBody += '<p><br><p>';
        emailBody += '<p>Cheers,<p>';
        emailBody += '<p><strong>Merchant Partner Management Team </strong><p>';


    
      GmailApp.createDraft(
        partnerEmail,            
        'Table22 x '+ partner +' - Final '+ thismonth +' Order Counts',  
        '',                     
        {
        htmlBody: emailBody    
        }
      );
      
      sheet.getRange(startRow + i, lastColumn).setValue(EMAIL_DRAFTED); 
      SpreadsheetApp.flush(); 
    }
  }
}
